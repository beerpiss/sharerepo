<!DOCTYPE html>
<html lang="en">

<head>
  <meta property="og:title" content="nordic sharerepo">
  <meta property="og:type" content="website">

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta property="og:description" content="Add repos to your favorite package manager">
  <meta property="description" content="Add repos to your favorite package manager">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/repo.css" />
  <link rel="stylesheet" href="css/nord.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="icon" type="image/png" href="icons/hekatoslogo-32x32.png" sizes="32x32">
</head>

<body>
  <template id="usage-template">
    <center>
      <h1></h1>
    </center>
  </template>

  <template id="group1-template">
    <h1 id="repo-url"></h1>
    <h3 hidden id="piracy-warning">
      You are attempting to add a repository that is known to be harmful for reasons such as piracy, illegal content, or malware.<br><br>

      Repositories marked as harmful often distribute software with unexpected effects, whether in the form of paid packages for free or other malicious packages. This can have lasting effects on your device and privacy, even sometimes affecting your ability to jailbreak.<br> 
      We recommend that you exercise extreme caution to avoid harmful software.<br>
    </h1>
  </template>

  <template id="repo-btns-template">
    <a class="btn" id="cydia" href="">
      <img class="icon" src="icons/pkgmgrs/cydia.png" alt="Cydia Icon">
      <span>Add to Cydia</span>
    </a>
  
    <a class="btn" id="sileo" href="">
      <img class="icon" src="icons/pkgmgrs/sileo.png" alt="Sileo Icon">
      <span>Add to Sileo</span>
    </a>
  
    <a class="btn" id="zebra" href="">
      <img class="icon" src="icons/pkgmgrs/zebra.png" alt="Zebra Icon">
      <span>Add to Zebra</span>
    </a>
  
    <a class="btn" id="installer" href="">
      <img class="icon" src="icons/pkgmgrs/installer.png" alt="AppTapp Installer 5 Icon">
      <span>Add to Installer</span>
    </a>
  
    <a class="btn" id="saily" href="">
      <img class="icon" src="icons/pkgmgrs/saily.png" alt="Saily Icon">
      <span>Add to Saily</span>
    </a>
  </template>

  <div>
    <div hidden id="usage"></div>
    <div id="group1" class="group1"></div>
    <div id="repo-btns" class="repo-btns"></div>
  </div>

  <script>
    async function isRepositoryPiracy(repo) {
      piracyList = await fetch("https://raw.githubusercontent.com/cnstr/manifests/gh-pages/piracy-repositories.json").then(resp => resp.json());
      return piracyList.includes((new URL(repo)).hostname)
    }

    function isRepositoryDefault(repo){
      repo = repo.replace(/\/$/, '');
      var defaultRepos = [
        "apt.bingner.com/",
        "apt.elucubratus.com/",
        "apt.procurs.us/",
        "ftp.sudhip.com/procursus",
        "repo.quiprr.dev/procursus",
        "apt.saurik.com/",
        "apt.oldcurs.us/",
        "repo.chimera.sh/",
        "diatr.us/apt",
        "repo.theodyssey.dev/",
      ];
      var repoURL = new URL(repo)
      return defaultRepos.includes(repoURL.hostname + repoURL.pathname)
    }

    var urlParams = new URLSearchParams(window.location.search);
    var repo = urlParams.get('repo');
    if (repo == null){
      usage = document.getElementById("usage-template").content.cloneNode(true);
      usage.querySelector('h1').innerText = `Usage: ${window.location.href}?repo=YOUR_REPO_URL`;
      
      usageElem = document.getElementById("usage");
      usageElem.appendChild(usage);
      usageElem.removeAttribute("hidden");
    }
    else if (isRepositoryDefault(repo)) {
      usage = document.getElementById("usage-template").content.cloneNode(true);
      usage.querySelector('h1').innerText = `Cannot add default repo: ${repo}`;
      
      usageElem = document.getElementById("usage");
      usageElem.appendChild(usage);
      usageElem.removeAttribute("hidden");
    }
    else {
      var pkgman = {
        "cydia": `https://cydia.saurik.com/api/share#?source=${repo}`,
        "sileo": `sileo://source/${repo}`,
        "zebra": `zbra://${repo}`,
        "installer": `installer://add/${repo}`,
        "saily": `apt-repo://${repo}`
      };
      
      isRepositoryPiracy(repo).then((resp) => {
        var repoURLElem = document.getElementById("group1-template").content.cloneNode(true);
        repoURLElem.querySelector('#repo-url').innerText = repo;
        if (resp) {
          warningIconElem = document.createElement("i");
          warningIconElem.className = "fa fa-exclamation-triangle"
          warningIconElem.setAttribute("aria-hidden", true)
          warningIconElem.setAttribute("style", "text-align: center; color: var(--nord13); font-size:75px; margin-top: 30px; margin-left: auto; margin-right: auto; display: block;")
          repoURLElem.querySelector('#piracy-warning').removeAttribute("hidden")
          repoURLElem.insertBefore(warningIconElem, repoURLElem.querySelector('#repo-url'));
        }
        else {
          var repoImageElem = new Image();
          repoImageElem.setAttribute("hidden", "");
          repoImageElem.loading = "eager";
          repoImageElem.id = "logo-main";
          repoImageElem.onload = () => {
            image = document.getElementById("logo-main");
            if (image.complete && image.naturalHeight > 0){
              image.removeAttribute("hidden")
              image.className = "logo-main";
            }
          }
          repoImageElem.src = `${repo.replace(/\/$/, '')}/CydiaIcon.png`;
          repoURLElem.insertBefore(repoImageElem, repoURLElem.querySelector('#repo-url'));
        }
        document.getElementById("group1").appendChild(repoURLElem);
      })
      
      var repoButtonsElem = document.getElementById("repo-btns-template").content.cloneNode(true);
      for (var key in pkgman) {
        repoButtonsElem.querySelector(`#${key}`).href = pkgman[key];
      }
      document.getElementById("repo-btns").appendChild(repoButtonsElem);
    }
  </script>
</body>